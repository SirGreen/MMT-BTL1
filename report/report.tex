\documentclass[a4paper]{article}
\usepackage{vntex}
%\usepackage[english,vietnam]{babel}
%\usepackage[utf8]{inputenc}

%\usepackage[utf8]{inputenc}
%\usepackage[francais]{babel}


\usepackage{float}
\usepackage{a4wide,amssymb,epsfig,latexsym,multicol,array,hhline,fancyhdr}
\usepackage{booktabs}
\usepackage{amsmath}
\usepackage{lastpage}
\usepackage[lined,boxed,commentsnumbered]{algorithm2e}
\usepackage{enumerate}
\usepackage{color}
\usepackage{graphicx}							% Standard graphics package
\usepackage{array}
\usepackage{tabularx, caption}
\usepackage{multirow}
\usepackage[framemethod=tikz]{mdframed}% For highlighting paragraph backgrounds
\usepackage{multicol}
\usepackage{rotating}
\usepackage{graphics}
\usepackage{geometry}
\usepackage{setspace}
\usepackage{epsfig}
\usepackage{tikz}
\usepackage{listings}
\usetikzlibrary{arrows,snakes,backgrounds}
\usepackage{hyperref}
\usepackage{scrextend}
\changefontsizes{13pt}
\usepackage{svg}
\usepackage{hyperref}
\usepackage{enumitem}
\usepackage{tocloft}
\renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}}
\renewcommand{\thesection}{\Roman{section}}
\hypersetup{urlcolor=blue,linkcolor=black,citecolor=black,colorlinks=true} 
%\usepackage{pstcol} 								% PSTricks with the standard color package



\newtheorem{theorem}{{\bf Định lý}}
\newtheorem{property}{{\bf Tính chất}}
\newtheorem{proposition}{{\bf Mệnh đề}}
\newtheorem{corollary}[proposition]{{\bf Hệ quả}}
\newtheorem{lemma}[proposition]{{\bf Bổ đề}}

\everymath{\color{blue}}
%\usepackage{fancyhdr}
\setlength{\headheight}{40pt}
\pagestyle{fancy}
\fancyhead{} % clear all header fields
\fancyhead[L]{
 \begin{tabular}{rl}
    \begin{picture}(25,15)(0,0)
    \put(0,-8){\includegraphics[width=8mm, height=8mm]{hcmut.png}}
    %\put(0,-8){\epsfig{width=10mm,figure=hcmut.eps}}
   \end{picture}&
	%\includegraphics[width=8mm, height=8mm]{hcmut.png} & %
	\begin{tabular}{l}
		\textbf{\bf \ttfamily Trường Đại Học Bách Khoa Tp.Hồ Chí Minh}\\
		\textbf{\bf \ttfamily Khoa Khoa Học và Kỹ Thuật Máy Tính}
	\end{tabular} 	
 \end{tabular}
}
\fancyhead[R]{
	\begin{tabular}{l}
		\tiny \bf \\
		\tiny \bf 
	\end{tabular}  }
\fancyfoot{} % clear all footer fields
\fancyfoot[L]{\scriptsize \ttfamily Bài tập lớn môn Mạng máy tính - Niên khóa 2024-2025}
\fancyfoot[R]{\scriptsize \ttfamily Trang {\thepage}/\pageref{LastPage}}
\renewcommand{\headrulewidth}{0.3pt}
\renewcommand{\footrulewidth}{0.3pt}


%%%
\setcounter{secnumdepth}{4}
\setcounter{tocdepth}{3}
\makeatletter
\newcounter {subsubsubsection}[subsubsection]
\renewcommand\thesubsubsubsection{\thesubsubsection .\@alph\c@subsubsubsection}
\newcommand\subsubsubsection{\@startsection{subsubsubsection}{4}{\z@}%
                                     {-3.25ex\@plus -1ex \@minus -.2ex}%
                                     {1.5ex \@plus .2ex}%
                                     {\normalfont\normalsize\bfseries}}
\newcommand*\l@subsubsubsection{\@dottedtocline{3}{10.0em}{4.1em}}
\newcommand*{\subsubsubsectionmark}[1]{}
\makeatother

\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}
\definecolor{backcolor}{RGB}{212,235,242}
\lstset{frame=tb,
	language=R,
	aboveskip=3mm,
	belowskip=3mm,
	showstringspaces=false,
	columns=flexible,
	basicstyle={\small\ttfamily},
	numbers=none,
	numberstyle=\tiny\color{gray},
	keywordstyle=\color{blue},
	commentstyle=\color{dkgreen},
	stringstyle=\color{mauve},
	breaklines=true,
	breakatwhitespace=true,
	tabsize=3,
	numbers=left,
	stepnumber=1,
	numbersep=1pt,    
	firstnumber=1,
	numberfirstline=true,
}

\usepackage{indentfirst}

% \documentclass{article}

\everymath{\color{black}} % Đặt màu đen cho chế độ toán học
\everydisplay{\color{black}} % Đặt màu đen cho môi trường toán học hiển thị

\renewcommand{\thesection}{\arabic{section}}

\begin{document}
\setlength{\parindent}{0.5cm}

\begin{titlepage}
\begin{center}
ĐẠI HỌC QUỐC GIA THÀNH PHỐ HỒ CHÍ MINH \\
TRƯỜNG ĐẠI HỌC BÁCH KHOA \\
KHOA KHOA HỌC - KỸ THUẬT MÁY TÍNH 
\end{center}

\begin{figure}[h!]
\begin{center}
\includegraphics[scale = 0.27]{01_logobachkhoasang.png}
\end{center}
\end{figure}


\begin{center}
\begin{tabular}{c}
	\multicolumn{1}{l}{\textbf{{\Large HỌC KỲ }}}\\
	~~\\
	\hline
	\\
	\multicolumn{1}{l}{\textbf{{\Large Bài tập lớn}}}\\
	\\
	
	\textbf{{\Huge Computer Network}}\\
	\\
	\hline
\end{tabular}
\end{center}

\begin{table}[h]
\begin{tabular}{rrll}
\hspace{2.5 cm} & GVHD: &  Hoàng Lê Hải Thanh\\
& SV: &  &\\
& &   Huỳnh Minh Khoa&- 2252346\\
& &Thân Nguyễn Minh Khoa &- 2252361\\
& & Trần Lương Yến Nhi &- 2252586\\
 & & Nguyễn Lê Vân Tú&- 2252881\\
\end{tabular}
\end{table}

\begin{center}
{\footnotesize TP. HỒ CHÍ MINH, THÁNG 10/2024}
\end{center}
\end{titlepage}

\newpage
\tableofcontents
\newpage

\section{Chức năng của ứng dụng}
\subsection{Chức năng ứng dụng chia sẻ tệp BitTorrent và giao thức giao tiếp}
    \textbf{File Discovery và chia sẻ Metadata}  
    \textit{Mô tả:} Cho phép người dùng định vị và truy xuất siêu dữ liệu về các tệp được chia sẻ hoặc tải xuống, thường thông qua các tệp .torrent hoặc magnet link.  

    \textbf{Peer Discovery}  
    \textit{Mô tả:} Cho phép nhận dạng và kết nối với các peer khác chia sẻ cùng một tệp, đảm bảo chia sẻ phân tán.  


    \textbf{Phân phối tập tin}  
    \textit{Mô tả:} Chia tệp thành các mảnh nhỏ hơn để chia sẻ hiệu quả. Mỗi mảnh được chia sẻ và xác minh riêng lẻ để đảm bảo tính toàn vẹn của dữ liệu.  
    

    \textbf{Tải lên}  
    \textit{Mô tả:} Xử lý việc gửi các phần tệp từ thiết bị của người dùng đến nhiều peer trong mạng. Đảm bảo cân bằng sự đóng góp và chia sẻ tài nguyên.  
    

    \textbf{Tải xuống}  
    \textit{Mô tả:} Quản lý việc nhận các mảnh tệp từ các peer khác. Đảm bảo sử dụng tối ưu tài nguyên mạng bằng cách tải xuống từ nhiều peer đồng thời.  
    

    \textbf{Xác minh mảnh}  
    \textit{Mô tả:} Xác minh tính toàn vẹn của từng mảnh được tải xuống bằng cách so sánh giá trị băm của nó với giá trị mong đợi, đảm bảo độ tin cậy của quá trình tải xuống.  
    

    \textbf{Chức năng Tit-for-Tat}  
    \textit{Mô tả:} Triển khai chiến lược để đảm bảo chia sẻ công bằng bằng cách ưu tiên các peer đóng góp nhiều dữ liệu hơn. Khuyến khích sự tương hỗ giữa các peer để cân bằng tải mạng.  
    

    \textbf{Chức năng mã hóa}  
    \textit{Mô tả:} Đảm bảo truyền dữ liệu an toàn bằng cách mã hóa thông tin liên lạc giữa các peer. Sử dụng cơ chế trao đổi khóa để thiết lập kết nối an toàn.  
    

    \textbf{Xử lý lỗi và phục hồi}  
    \textit{Mô tả:} Phát hiện và phục hồi các sự cố như tải xuống không đầy đủ hoặc bị hỏng. Thử lại các lần tải xuống không thành công và yêu cầu lại các phần bị thiếu từ các peer khác.  
    

\subsection{Chức năng dành riêng cho Tracker}

    \textbf{Đăng kí Tracker}  
    \textit{Mô tả:} Đăng ký những peer mới với trình theo dõi để cho phép tham gia vào mạng chia sẻ tệp.  
    

    \textbf{Thông báo Tracker}  
    \textit{Mô tả:} Cập nhật trình theo dõi với trạng thái của peer, chẳng hạn như tiến trình tải lên/tải xuống, các tệp mà máy khách đang seeding và trạng thái kết nối.  
    
    \textbf{Truy xuất danh sách Tracker Peer}  
    \textit{Mô tả:} Cho phép các peer lấy danh sách các peer khác chia sẻ cùng một tệp từ trình theo dõi.  
    

\section{Giao thức}

    \subsection{Giao thức Uploader - Downloader}
        \subsubsection{Downloader và Uploader} Lần lượt chờ đợi tin nhắn của nhau ứng theo các trường cần lưu
        \newline
        \newline
            \textbf{B1}: Downloader kết nối với Uploader:
                \begin{itemize}
                    \item Downloader: Client gửi kết nối
                    \item Uploader: Gửi lại message: \textquotedblleft\textquotedblleft Got connection from\textquotedblright{} $+$ client\_addr\textquotedblright{} để xác nhận.
                \end{itemize}
            \textbf{B2}: Downloader sau khi nhận tin xác nhận kết nối sẽ bắt đầu tải file từ Uploader:
                \begin{itemize}
                    \item Downloader: Gửi message: reponame (với reponame là torrent hash)
                    \item Uploader: Từ reponame truy suất ra một mảng mà các phần tử là giá trị nhị phân tượng trưng cho các Piece mà Uploader đã tải xuống
                \end{itemize}
            \textbf{B3}: Downloader chọn chunk muốn được tải từ Uploader:
                Uploader sẽ nằm trong vòng lặp chờ nhận các integer cho đến khi ngắt kết nối:
                \begin{itemize}
                    \item B3.1: Downloader: Sẽ gửi 1 interger ứng với vị trí Piece cần tải
                    \item B3.2: Uploader: Sau khi nhận sẽ bắt đầu gửi dữ liệu từ Piece với độ dài Piece theo Piece\_length được lưu trong file Torrent cho Downloader
                    \item B3.3: Downloader: Sẽ nhận và xử lý dữ liệu và lập lại bước 3.1 cho đến khi hết Piece để download từ Uploader này hoặc đã tải hết tất cả các Piece
                \end{itemize}
        \subsubsection{Lý do sử dụng socket}
        \begin{itemize}
            \item Socket cho phép kết nối trực tiếp giữa các thiết bị, giúp truyền dữ liệu nhanh chóng và hiệu quả.
            \item Socket cung cấp tốc độ và hiệu quả cao nhờ giao thức TCP đảm bảo độ tin cậy và đúng thứ tự, cũng như có thể kiểm soát chặt chẽ việc truyền tải và linh hoạt chọn giữa các giao thức như TCP hoặc UDP tùy theo nhu cầu.
            \item Socket cho phép truyền tải dữ liệu hai chiều, tức là cả hai bên (client và server) đều có thể gửi và nhận dữ liệu qua đó thuận tiện cho việc trao đổi liên tục giữa Uploader và Downloader.
            \item Sockets cho phép các ứng dụng có thể thực hiện nhiều kết nối đồng thời (thông qua các thư viện hỗ trợ như threading, asyncio trong Python), giúp tăng cường khả năng xử lý của ứng dụng. Ví dụ: một máy chủ có thể sử dụng socket để xử lý nhiều yêu cầu từ nhiều client cùng lúc mà không bị gián đoạn.
            \item Socket có thể được sử dụng trên nhiều hệ điều hành và nền tảng khác nhau như Windows, macOS, Linux, và các thiết bị di động. Điều này giúp ứng dụng mạng sử dụng socket có thể dễ dàng tương thích và hoạt động trên nhiều thiết bị khác nhau.
        \end{itemize}

    \subsection{Giao thức Client - Tracker}
    Được xây dụng dựa trên giao thức HTTP, các client gửi các thông báo đến tracker thông qua giao thức HTTP GET \textquotedblleft \/announce\textquotedblright $+$ /<command> \textquotedblright $+$ \textquotedblleft $?$ \textquotedblright $+$  tham số
    \subsubsection{Client và Tracker}
    \begin{itemize}
        \item Client tham gia vào Tracker:
        \begin{itemize}
            \item \textquotedblleft/announce/join$?$peerid=BKU$-$Torrent$-$836763067317\&port$=$8333\textquotedblright
            \item Tracker sẽ dựa vào peerid để đưa Client vào swarm và lưu lại port mà client đang mở để chấp nhận kết nối từ các client khác.
        \end{itemize}
        \item Client thông báo có đủ file cho Tracker:
        \begin{itemize}
            \item \textquotedblleft/announce/have?torrent\_hash$=$\%C1\%27\%12\%94\%D7\%F6\%CB5\%94\%FB\%09 \%10\%7Bs\%C1\%BF\%85\%24\%16B\&peerid$=$BKU$-$Torrent$-$836763067317\textquotedblright
            \item Tracker sẽ lưu thông tin của client có peerid đang chia sẻ file theo tham số torrent\_hash là mã hash đại diện cho file torrent đó.
        \end{itemize}
        \item Client thông báo muốn tải file cho Tracker:
        \begin{itemize}
            \item \textquotedblleft/announce/down?torrent\_hash\=\%C1\%27\%12\%94\%D7\%F6\%CB5\%94\%FB\%09 \%10\%7Bs\%C1\%BF\%85\%24\%16B\&peerid$=$BKU$-$Torrent$-$836763067317\textquotedblright
            \item Tracker sẽ dựa vào torrent\_hash để gửi cho peerid một danh sách các IP và port của các client đang có file và đồng thời thêm peerid vào danh sách đó.
        \end{itemize}
        \item Client thông báo thoát khỏi Tracker:
        \begin{itemize}
            \item \textquotedblleft/announce/exit?peerid\=BKU\-Torrent\-836763067317\textquotedblright
            \item Tracker sẽ xóa peerid ra khỏi swarm và danh sách các file mà peerid có.
        \end{itemize}
        \item Client kiểm tra Tracker có hoạt động:
        \begin{itemize}
            \item \textquotedblleft/announce/ping\textquotedblright
            \item Tracker sẽ trả về \textquotedblleft OK\textquotedblright nếu còn hoạt động.
        \end{itemize}
    \end{itemize}
\subsubsection{Một số lý do chính khi dùng HTTP để giao tiếp giữa client và tracker trong BitTorrent:}
\textbf{Phổ biến và dễ triển khai}
\begin{itemize}
    \item HTTP là giao thức phổ biến và đã được sử dụng rộng rãi, hỗ trợ trên hầu hết các mạng và thiết bị. Điều này giúp việc triển khai tracker dễ dàng hơn vì có thể sử dụng cơ sở hạ tầng mạng sẵn có, như các máy chủ web và cổng HTTP.
\end{itemize}

\textbf{Tương thích tốt với tường lửa và NAT}
\begin{itemize}
    \item HTTP hoạt động trên cổng 80 hoặc 443, các cổng này thường được mở trên hầu hết các tường lửa và thiết bị NAT. Điều này giúp client dễ dàng kết nối với tracker mà ít gặp trở ngại, tránh được các hạn chế mạng mà các giao thức không phổ biến hơn có thể gặp phải.
\end{itemize}

\textbf{Dễ mở rộng và hỗ trợ}
\begin{itemize}
    \item HTTP là giao thức linh hoạt, hỗ trợ nhiều tính năng nâng cao như truyền tải qua HTTPS, giúp bảo mật dữ liệu. Sử dụng HTTP cũng giúp tracker dễ dàng mở rộng hoặc thay đổi để hỗ trợ nhiều loại client khác nhau, kể cả khi các client sử dụng phần mềm và phiên bản khác nhau.
\end{itemize}

\textbf{Tận dụng các công nghệ sẵn có}
\begin{itemize}
    \item Các công nghệ web khác như caching (bộ nhớ đệm) và load balancing (cân bằng tải) có thể dễ dàng áp dụng cho tracker khi dùng HTTP. Ví dụ, nếu nhiều client cùng yêu cầu thông tin về một torrent, tracker có thể tận dụng cache để trả về thông tin này nhanh chóng mà không cần xử lý lại từ đầu.
\end{itemize}

\textbf{Hiệu quả và tiết kiệm tài nguyên}
\begin{itemize}
    \item Các yêu cầu HTTP thường là đơn giản và nhẹ, chứa các tham số cần thiết trong URL (như /announce?torrent\_hash$=$ ...\&peer\_id$=$...). Điều này giúp tracker xử lý nhiều yêu cầu cùng lúc mà không tốn quá nhiều tài nguyên, thích hợp cho hệ thống theo dõi mạng ngang hàng (P2P) có lượng yêu cầu rất lớn.
\end{itemize}

\subsection{Biểu đồ:}

\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{MVC.png}
    \captionsetup{labelformat=empty}
    \caption{MVC}
    \label{fig:mvc}
\end{figure}

\textbf{Flow chart của các module:}

\includegraphics[width=0.5\textwidth]{join_module.png} 

\includegraphics[width=0.5\textwidth]{have_module.png} 

\includegraphics[width=0.5\textwidth]{file_sharing_module.png}

\includegraphics[width=0.5\textwidth]{exit_module.png} 

\end{document}
